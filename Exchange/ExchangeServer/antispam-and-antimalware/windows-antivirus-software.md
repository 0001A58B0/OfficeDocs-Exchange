---
title: "Running Windows antivirus software on Exchange servers"
ms.author: chrisda
author: chrisda
manager: serdars
ms.date: 7/9/2018
ms.audience: ITPro
ms.topic: reference
ms.prod: exchange-server-itpro
localization_priority: Normal
ms.assetid: 7cef6017-7a55-41f3-a636-1ca4fce575b1
description: "Summary: Learn about setting up Windows antivirus programs to run successfully on Exchange servers by configuring exclusions."
---

# Running Windows antivirus software on Exchange servers

 **Summary**: Learn about setting up Windows antivirus programs to run successfully on Exchange 2016 or Exchange 2019 servers by configuring exclusions.

When you run Windows antivirus programs on Microsoft Exchange servers, you can help enhance the security and health of your Exchange organization. However, if they aren't configured correctly, Windows antivirus programs can cause problems in Exchange Server.

There are two basic components of any Windows antivirus program:

- *Memory-resident scanning* or *real-time protection* monitors all files and processes that are loaded and running in a computer's active memory.

- *File-level scanning* refers to checking files on the hard disk for viruses manually or on a regular schedule. Some antivirus programs start an on-demand scan automatically after the virus signatures are updated to make sure that all files are scanned with the latest signatures.

The biggest potential problem is a Windows antivirus program might lock or quarantine an open log file or database file that Exchange needs to modify. This can cause severe failures in Exchange Server, and it might also generate 1018 event log errors. Therefore, excluding these files from being scanned by the Windows antivirus program is very important.

Another issues to consider is that Windows antivirus programs can't replace email-based antispam and antimalware solutions because Windows antivirus programs that run on Windows servers can't detect viruses, malware, and spam that are distributed only through email.

## Recommended exclusions for Windows antivirus programs on Exchange servers

When you deploy a Windows antivirus program on an Exchange server, make sure that the folder exclusions, process exclusions, and file name extension exclusions that are described in these sections are configured for both memory-resident and file-level scanning.

 **Note**: The **%ExchangeInstallPath%** value is typically `C:\Program Files\Microsoft\Exchange Server\V15\` (includes a trailing "\"), the **%SystemRoot%** value is typically `C:\Windows` (doesn't include a trailing "\"), and the **%SystemDrive%** value is typically `C:` (doesn't include a trailing "\").

The locations of many of these Exchange folders are configurable in the Exchange Management Shell. To learn how to open the Exchange Management Shell in your on-premises Exchange organization, see [Open the Exchange Management Shell](https://docs.microsoft.com/powershell/exchange/exchange-server/open-the-exchange-management-shell).

### Folder exclusions
<a name="Folder"> </a>

Exclude the following folders from file-level scanning and memory-resident scanning on Exchange 2016 or Exchange 2019 servers.

> [!NOTE]
> Unified Messaging is not available on Exchange 2019.

****

|**Folder**|**Category**|**Description**|**Servers**|
|:-----|:-----|:-----|:-----|
| `%SystemRoot%\Cluster` <br/> |DAGs  <br/> |The cluster quorum database and other files for database availability groups (DAGs).  <br/> |Mailbox servers  <br/> |
| `%SystemDrive%\DAGFileShareWitnesses\<DAGFQDN>` <br/> |DAGs  <br/> |The witness directory on the witness server that's configured for the DAG. The witness server can be virtually any Microsoft Windows server in the local Active Directory forest that isn't already a member of the DAG.  <br/> To see the actual location, run the following command: `Get-DatabaseAvailabilityGroup <DAGName>| Format-List *Witness*` <br/> |Any  <br/> |
| `%ExchangeInstallPath%ClientAccess\OAB` <br/> |Offline Address Books  <br/> |Offline Address Book files.  <br/> |Mailbox servers  <br/> |
| `%ExchangeInstallPath%FIP-FS` <br/> |Antimalware and DLP  <br/> |Content scanning that's used by the Malware agent and data loss prevention (DLP).  <br/> |Mailbox servers  <br/> |
| `%ExchangeInstallPath%GroupMetrics` <br/> |MailTips  <br/> |Group Metrics files that are used to calculate values for the Large Audience and External Recipients MailTips.  <br/> |Mailbox servers  <br/> |
| `%ExchangeInstallPath%Logging` <br/> |Exchange process logs  <br/> |This folder contains many different types of Exchange logs in subfolders. For example:  <br/> • Calendar Repair Assistant logs  <br/> • Managed Folder Assistant logs  <br/> • IMAP4 protocol logs  <br/> • POP3 protocol logs  <br/> To see the actual locations, run the following commands:  <br/> `Get-MailboxServer -Server <ServerName> | Format-List *LogPath*` <br/> `Get-PopSettings <ServerName> | Format-List LogFileLocation` <br/> `Get-ImapSettings <ServerName> | Format-List LogFileLocation` <br/> ||
| `%ExchangeInstallPath%Mailbox` <br/> |Mailbox databases  <br/> |Exchange databases, checkpoint files, and log files. By default, these files are located in subfolders based on the name of the database. To see the actual locations, run the following command: `Get-MailboxDatabase -Server <ServerName> | Format-List EdbFilePath,LogFolderPath` <br/> By default, database context index files are located in the same folder as the database files in a subfolder that's named after the GUID of the database.  <br/> |Mailbox servers  <br/> |
| `%ExchangeInstallPath%TransportRoles\Data\Adam` <br/> |EdgeSync  <br/> |Active Directory Lightweight Directory Services (AD LDS) and log files.  <br/> |Edge Transport servers  <br/> |
| `%ExchangeInstallPath%TransportRoles\Data\IpFilter` <br/> |Connection filtering  <br/> |IP filter database, checkpoint, and log files.  <br/> |Edge Transport servers  <br/> |
| `%ExchangeInstallPath%TransportRoles\Data\Queue` <br/> |Queues  <br/> |Queue database, checkpoint, and log files.  <br/> |Mailbox servers  <br/> Edge Transport servers  <br/> |
| `%ExchangeInstallPath%TransportRoles\Data\SenderReputation` <br/> |Sender reputation  <br/> |Sender Reputation database, checkpoint, and log files.  <br/> |Edge Transport servers  <br/> Mailbox servers  <br/> |
| `%ExchangeInstallPath%TransportRoles\Data\Temp` <br/> |Content conversion  <br/> |Content conversion that's done in the transport pipeline.  <br/> |Mailbox servers  <br/> Edge Transport servers  <br/> |
| `%ExchangeInstallPath%TransportRoles\Logs` <br/> |Transport logs  <br/> |Mail flow and transport pipeline logs are located in subfolders, for example:  <br/> • Agent logging  <br/> • Connectivity logging  <br/> • Message tracking  <br/> • Pipeline tracing  <br/> • Send and Receive connector protocol logging  <br/> To see the actual locations, run the following commands:  <br/> `Get-TransportService <ServerName> | Format-List *LogPath,*TracingPath` <br/> `et-FrontEndTransportService <ServerName> | Format-List *LogPath` <br/> `Get-MailboxTransportService <ServerName> | Format-List *LogPath,*TracingPath` <br/> |Mailbox servers  <br/> Edge Transport servers (Transport service only)  <br/> |
| ` %ExchangeInstallPath%TransportRoles\Pickup ` <br/> |Pickup directory  <br/> |The Pickup directory is used by administrators for mail flow testing or by applications that need to create and submit their own message files.  <br/> To see the actual location, run the following command: `Get-TransportService <ServerName>| Format-List PickupDirectoryPath` <br/> |Mailbox servers  <br/> Edge Transport servers  <br/> |
| ` %ExchangeInstallPath%TransportRoles\Replay ` <br/> |Replay directory  <br/> |The Replay directory receives messages from foreign gateway servers and can also be used to resubmit messages that administrators export from the queues of Exchange servers.  <br/> To see the actual location, run the following command: `Get-TransportService <ServerName>| Format-List ReplayDirectoryPath` <br/> |Mailbox servers  <br/> Edge Transport servers  <br/> |
| `%ExchangeInstallPath%UnifiedMessaging\Grammars` <br/> |Unified Messaging  <br/> |Grammar files for different locales, for example en-EN or es-ES.  <br/> |Mailbox servers  <br/> |
| `%ExchangeInstallPath%UnifiedMessaging\Prompts` <br/> |Unified Messaging  <br/> |Voice prompts, greetings, and informational message files.  <br/> |Mailbox servers  <br/> |
| `%ExchangeInstallPath%UnifiedMessaging\Temp` <br/> |Unified Messaging  <br/> |Temporary files generated by Unified Messaging.  <br/> |Mailbox servers  <br/> |
| `%ExchangeInstallPath%UnifiedMessaging\Voicemail` <br/> |Unified Messaging  <br/> |Voice mail files that are temporarily stored.  <br/> |Mailbox servers  <br/> |
| `%ExchangeInstallPath%Working\OleConverter` <br/> |Content conversion  <br/> |Transport Neutral Encoding Format (TNEF), also known as Rich Text Format (RTF), to MIME/HTML conversions.  <br/> |Mailbox servers  <br/> Edge Transport servers  <br/> |
| `%SystemDrive%\inetpub\temp\IIS Temporary Compressed Files` <br/> |Web components  <br/> |Internet Information Services (IIS) compression folder that's used with Outlook on the web.  <br/> |Mailbox servers  <br/> |
| `%SystemRoot%\Microsoft.NET\Framework64\v4.0.30319\Temporary ASP.NET Files` <br/> |Web components  <br/> |Temporary files that are used with Exchange services. These files are located in the following subfolders:  <br/> autodiscover  <br/> ecp  <br/> ecp  <br/> ews  <br/> mapi  <br/> mapi_emsmdb  <br/> microsoft-server-activesync  <br/> oab  <br/> owa  <br/> owa_calendar  <br/> powershell  <br/> root  <br/> rpc  <br/> |Mailbox servers  <br/> |
| `%SystemRoot%\System32\Inetsrv` <br/> |Web components  <br/> | IIS system files.  <br/> |Mailbox servers  <br/> |
|%SystemRoot%\Temp\OICE_ _\<GUID\>_\  <br/> |Exchange Search  <br/> |Temporary files used by the Exchange Search service and Microsoft Filter Pack to perform file conversion in a sandboxed environment.  <br/> |Mailbox servers  <br/> |
 
### Process exclusions
<a name="Process"> </a>

Many antivirus programs support the scanning of processes, which can adversely affect Microsoft Exchange if the incorrect processes are scanned. Therefore, you should exclude the following Exchange or related processes from process scanning.

|**Process**|**Path**|**Comments**|**Servers**|
|:-----|:-----|:-----|:-----|
|ComplianceAuditService.exe  <br/> | `%ExchangeInstallPath%Bin` <br/> |Microsoft Exchange Compliance Audit service (MSComplianceAudit)  <br/> |Mailbox servers  <br/> |
|Dsamain.exe  <br/> | `%SystemRoot%\System32` <br/> | Microsoft Exchange ADAM service (ADAM_MSExchange) (Active Directory Lightweight Directory Services (AD LDS) on subscribed Edge Transport servers)  <br/> |Edge Transport servers  <br/> |
|EdgeTransport.exe  <br/> | `%ExchangeInstallPath%Bin` <br/> |Microsoft Exchange Transport service worker process  <br/> |Mailbox servers  <br/> Edge Transport servers  <br/> |
|fms.exe  <br/> | `%ExchangeInstallPath%FIP-FS\Bin` <br/> |Content scanning component that's used by the Malware agent and DLP.  <br/> |Mailbox servers  <br/> |
|hostcontrollerservice.exe  <br/> | `%ExchangeInstallPath%Bin\Search\Ceres\HostController` <br/> |Microsoft Exchange Search Host Controller service (HostControllerService)  <br/> |Mailbox servers  <br/> |
|inetinfo.exe  <br/> | `%SystemRoot%\System32\inetsrv` <br/> |Internet Information Services (IIS)  <br/> |Mailbox servers  <br/> |
|Microsoft.Exchange.AntispamUpdateSvc.exe  <br/> | `%ExchangeInstallPath%Bin` <br/> |Microsoft Exchange Antispam Update service (MSExchangeAntispamUpdate)  <br/> |Mailbox servers  <br/> Edge Transport servers  <br/> |
|Microsoft.Exchange.ContentFilter.Wrapper.exe  <br/> | `%ExchangeInstallPath%TransportRoles\agents\Hygiene` <br/> |Content Filter agent  <br/> |Mailbox servers  <br/> Edge Transport servers  <br/> |
|Microsoft.Exchange.Diagnostics.Service.exe  <br/> | `%ExchangeInstallPath%Bin` <br/> |Microsoft Exchange Diagnostics service (MSExchangeDiagnostics)  <br/> |Mailbox servers  <br/> Edge Transport servers  <br/> |
|Microsoft.Exchange.Directory.TopologyService.exe  <br/> | `%ExchangeInstallPath%Bin` <br/> |Microsoft Exchange Active Directory Topology service (MSExchangeADTopology)  <br/> |Mailbox servers  <br/> |
|Microsoft.Exchange.EdgeCredentialSvc.exe  <br/> | `%ExchangeInstallPath%Bin` <br/> |Microsoft Exchange Credential service (MSExchangeEdgeCredential)  <br/> |Edge Transport servers  <br/> |
|Microsoft.Exchange.EdgeSyncSvc.exe  <br/> | `%ExchangeInstallPath%Bin` <br/> |Microsoft Exchange EdgeSync service (MSExchangeEdgeSync)  <br/> |Mailbox servers  <br/> |
|Microsoft.Exchange.Imap4.exe  <br/> | `ExchangeInstallPath%FrontEnd\PopImap` <br/> |Microsoft Exchange IMAP4 service (MSExchangeImap4)  <br/> |Mailbox servers  <br/> |
|Microsoft.Exchange.Imap4service.exe  <br/> | `%ExchangeInstallPath%ClientAccess\PopImap` <br/> |Microsoft Exchange IMAP4 Backend service (MSExchangeIMAP4BE)  <br/> |Mailbox servers  <br/> |
|Microsoft.Exchange.Notifications.Broker.exe  <br/> | `%ExchangeInstallPath%Bin` <br/> |Microsoft Exchange Notifications Broker service (MSExchangeNotificationsBroker)  <br/> |Mailbox servers  <br/> |
|Microsoft.Exchange.Pop3.exe  <br/> | `%ExchangeInstallPath%FrontEnd\PopImap` <br/> |Microsoft Exchange POP3 service (MSExchangePop3)  <br/> |Mailbox servers  <br/> |
|Microsoft.Exchange.Pop3service.exe  <br/> | `%ExchangeInstallPath%ClientAccess\PopImap` <br/> |Microsoft Exchange POP3 Backend service (MSExchangePOP3BE)  <br/> |Mailbox servers  <br/> |
|Microsoft.Exchange.ProtectedServiceHost.exe  <br/> | `%ExchangeInstallPath%Bin` <br/> |Microsoft Exchange Service Host service (MSExchangeServiceHost)  <br/> |Mailbox servers  <br/> Edge Transport servers  <br/> |
|Microsoft.Exchange.RPCClientAccess.Service.exe  <br/> | `%ExchangeInstallPath%Bin` <br/> |Microsoft Exchange RPC Client Access service (MSExchangeRPC)  <br/> |Mailbox servers  <br/> |
|Microsoft.Exchange.Search.Service.exe  <br/> | `%ExchangeInstallPath%Bin` <br/> |Microsoft Exchange Search service (MSExchangeFastSearch)  <br/> |Mailbox servers  <br/> |
|Microsoft.Exchange.Servicehost.exe  <br/> | `%ExchangeInstallPath%Bin` <br/> |Microsoft Exchange Service Host service (MSExchangeServiceHost)  <br/> |Mailbox servers  <br/> Edge Transport servers  <br/> |
|Microsoft.Exchange.Store.Service.exe  <br/> | `%ExchangeInstallPath%Bin` <br/> |Microsoft Exchange Information Store service (MSExchangeIS)  <br/> |Mailbox servers  <br/> |
|Microsoft.Exchange.Store.Worker.exe  <br/> | `%ExchangeInstallPath%Bin` <br/> |Microsoft Exchange Information Store service worker process  <br/> |Mailbox servers  <br/> |
|Microsoft.Exchange.UM.CallRouter.exe  <br/> | `%ExchangeInstallPath%FrontEnd\CallRouter` <br/> |Microsoft Exchange Unified Messaging Call Router service (MSExchangeUMCR)  <br/> |Mailbox servers  <br/> |
|MSExchangeCompliance.exe  <br/> | `%ExchangeInstallPath%Bin` <br/> |Microsoft Exchange Compliance Service (MSExchangeCompliance)  <br/> |Mailbox servers  <br/> |
|MSExchangeDagMgmt.exe  <br/> | `%ExchangeInstallPath%Bin` <br/> |Microsoft Exchange DAG Management service (MSExchangeDagMgmt)  <br/> |Mailbox servers  <br/> |
|MSExchangeDelivery.exe  <br/> | `%ExchangeInstallPath%Bin` <br/> |Microsoft Exchange Mailbox Transport Delivery service (MSExchangeDelivery)  <br/> |Mailbox servers  <br/> |
|MSExchangeFrontendTransport.exe  <br/> | `%ExchangeInstallPath%Bin` <br/> |Microsoft Exchange Frontend Transport service (MSExchangeFrontEndTransport)  <br/> |Mailbox servers  <br/> |
|MSExchangeHMHost.exe  <br/> | `%ExchangeInstallPath%Bin` <br/> |Microsoft Exchange Health Manager service (MSExchangeHM)  <br/> |Mailbox servers  <br/> Mailbox servers  <br/> Edge Transport servers  <br/> |
|MSExchangeHMWorker.exe  <br/> | `%ExchangeInstallPath%Bin` <br/> |Microsoft Exchange Health Manager service worker process  <br/> |Mailbox servers  <br/> Mailbox servers  <br/> Edge Transport servers  <br/> |
|MSExchangeMailboxAssistants.exe  <br/> | `%ExchangeInstallPath%Bin` <br/> |Microsoft Exchange Mailbox Assistants service (MSExchangeMailboxAssistants)  <br/> |Mailbox servers  <br/> |
|MSExchangeMailboxReplication.exe  <br/> | `%ExchangeInstallPath%Bin` <br/> |Microsoft Exchange Mailbox Replication service (MSExchangeMailboxReplication)  <br/> |Mailbox servers  <br/> |
|MSExchangeRepl.exe  <br/> | `%ExchangeInstallPath%Bin` <br/> |Microsoft Exchange Replication service (MSExchangeRepl)  <br/> |Mailbox servers  <br/> |
|MSExchangeSubmission.exe  <br/> | `%ExchangeInstallPath%Bin` <br/> |Microsoft Exchange Mailbox Transport Submission service (MSExchangeSubmission)  <br/> |Mailbox servers  <br/> |
|MSExchangeTransport.exe  <br/> | `%ExchangeInstallPath%Bin` <br/> |Microsoft Exchange Transport service (MSExchangeTransport)  <br/> |Mailbox servers  <br/> Edge Transport servers  <br/> |
|MSExchangeTransportLogSearch.exe  <br/> | `%ExchangeInstallPath%Bin` <br/> |Microsoft Exchange Transport Log Search service (MSExchangeTransportLogSearch)  <br/> |Mailbox servers  <br/> Edge Transport servers  <br/> |
|MSExchangeThrottling.exe  <br/> | `%ExchangeInstallPath%Bin` <br/> |Microsoft Exchange Throttling service (MSExchangeThrottling)  <br/> |Mailbox servers  <br/> |
|Noderunner.exe  <br/> | `%ExchangeInstallPath%Bin\Search\Ceres\Runtime\1.0` <br/> |Microsoft Exchange Search service (MSExchangeFastSearch)  <br/> |Mailbox servers  <br/> |
|OleConverter.exe  <br/> | `%ExchangeInstallPath%Bin` <br/> |Converts rich text format (RTF) messages to MIME/HTML for external recipients.  <br/> |Mailbox servers  <br/> |
|ParserServer.exe  <br/> | `%ExchangeInstallPath%Bin\Search\Ceres\ParserServer` <br/> |Microsoft Exchange Search service (MSExchangeFastSearch)  <br/> |Mailbox servers  <br/> |
|Powershell.exe  <br/> | `C:\Windows\System32\WindowsPowerShell\v1.0` <br/> |Exchange Management Shell  <br/> |Mailbox servers  <br/> Edge Transport servers  <br/> |
|ScanEngineTest.exe  <br/> | `%ExchangeInstallPath%FIP-FS\Bin` <br/> |Content scanning component that's used by the Malware agent and DLP  <br/> |Mailbox servers  <br/> |
|ScanningProcess.exe  <br/> | `%ExchangeInstallPath%FIP-FS\Bin` <br/> |Content scanning component that's used by the Malware agent and DLP  <br/> |Mailbox servers  <br/> |
|UmService.exe  <br/> | `%ExchangeInstallPath%Bin` <br/> |Microsoft Exchange Unified Messaging service (MSExchangeUM)  <br/> |Mailbox servers  <br/> |
|UmWorkerProcess.exe  <br/> | `%ExchangeInstallPath%Bin` <br/> |Microsoft Exchange Unified Messaging service worker process  <br/> |Mailbox servers  <br/> |
|UpdateService.exe  <br/> | `%ExchangeInstallPath%FIP-FS\Bin` <br/> |Content scanning component that's used by the Malware agent and DLP  <br/> |Mailbox servers  <br/> |
|W3wp.exe  <br/> | `%SystemRoot%\System32\inetsrv` <br/> |Internet Information Services (IIS)  <br/> |Mailbox servers  <br/> |
|wsbexchange.exe  <br/> | `%ExchangeInstallPath%Bin` <br/> |Microsoft Exchange Server Extension for Windows Server Backup (wsbexchange)  <br/> |Mailbox servers  <br/> |
 
### File name extension exclusions
<a name="FileName"> </a>

In addition to excluding specific folders and processes, you should exclude the following Exchange-specific file name extensions in case folder exclusions fail or files are moved from their default locations.

****

|**Extensions**|**Description**|**Servers**|
|:-----|:-----|:-----|
|.config  <br/> |Application-related extensions  <br/> |Mailbox servers  <br/> Edge Transport servers  <br/> |
|.chk  <br/> .edb  <br/> .jfm  <br/> .jrs  <br/> .log  <br/> .que  <br/> |Database-related extensions  <br/> |Mailbox servers  <br/> Edge Transport servers  <br/> |
|.dsc  <br/> .txt  <br/> |Group Metrics-related extensions  <br/> |Mailbox servers  <br/> |
|.cfg  <br/> .grxml  <br/> |Unified Messaging-related extensions  <br/> |Mailbox servers  <br/> |
|.lzx  <br/> |Offline address book-related extensions  <br/> |Mailbox servers  <br/> |
 

